# 🧠 QueryReform — Project Structure & Overview

A unified, reproducible **Python toolkit** for *LLM-based query reformulation methods*.

This document describes the **folder hierarchy**, **purpose of each module**, and **how all components fit together**.

---

## 🌲 Full Directory Tree

```text
queryreform/
├── pyproject.toml
├── README.md
├── LICENSE
├── .gitignore
├── .env.example
├── CONTRIBUTING.md
├── PROJECT_STRUCTURE.md
│
├── docs/
│   ├── PROMPTS.md
│   ├── DATASETS.md
│   └── CLI.md
│
├── examples/
│   ├── quickstart.ipynb
│   └── tiny_queries.tsv
│
├── scripts/
│   └── templated_retrieval.sh
│
├── tests/
│   ├── test_dataloader.py
│   ├── test_prompts.py
│   ├── test_methods_genqr.py
│   └── test_cli_script_gen.py
│
└── queryreform/
    ├── __init__.py
    ├── cli.py
    ├── prompt_bank.yaml
    ├── pyserini_bridge.py
    │
    ├── config/
    │   └── defaults.yaml
    │
    ├── core/
    │   ├── base.py
    │   ├── llm.py
    │   ├── prompts.py
    │   ├── registry.py
    │   ├── runner.py
    │   └── utils.py
    │
    ├── data/
    │   └── dataloader.py
    │
    └── methods/
        ├── __init__.py
        ├── genqr.py
        ├── genqr_ensemble.py
        ├── query2doc.py
        ├── qa_expand.py
        ├── mugi.py
        ├── lamer.py
        └── query2e.py

---

## 🏠 Root Directory

| File | Purpose |
|------|----------|
| **pyproject.toml** | Defines package metadata, dependencies, and entry points (CLI via Typer). |
| **README.md** | Project overview, installation, and usage examples. |
| **LICENSE** | MIT License. |
| **.gitignore** | Standard Python ignores (cache, build, etc.). |
| **.env.example** | Environment variable template (e.g., `OPENAI_API_KEY`, `OPENAI_BASE_URL`). |
| **CONTRIBUTING.md** | Guidelines for contributing new methods or prompts. |
| **PROJECT_STRUCTURE.md** | This document. |

---

## 📚 Documentation (`docs/`)

Markdown documentation for key features.

| File | Description |
|------|--------------|
| **PROMPTS.md** | Explains how to structure and contribute to the central prompt bank. |
| **DATASETS.md** | Describes how to load MS MARCO, BEIR, or local datasets. |
| **CLI.md** | Reference for CLI commands and arguments. |

---

## 🧩 Examples (`examples/`)

| File | Description |
|------|--------------|
| **quickstart.ipynb** | Minimal notebook demonstrating data loading and query reformulation. |
| **tiny_queries.tsv** | Tiny sample dataset for dry-run testing. |

---

## ⚙️ Scripts (`scripts/`)

| File | Description |
|------|--------------|
| **templated_retrieval.sh** | Example shell script generated by the CLI command `queryreform script-gen`. |

---

## ✅ Tests (`tests/`)

Automated unit tests for core modules and method logic (run via `pytest`).

| File | Description |
|------|--------------|
| **test_dataloader.py** | Validates `UnifiedQuerySource` for local TSV input. |
| **test_prompts.py** | Verifies prompt bank integrity. |
| **test_methods_genqr.py** | Tests `GenQREnsemble` reformulation workflow. |
| **test_cli_script_gen.py** | Ensures CLI generates valid retrieval bash scripts. |

---

## 🧠 Main Package (`queryreform/`)

This directory contains all toolkit code.

### 🔹 CLI Interface (`cli.py`)
Implements the **Typer-based** command-line interface with commands:
- `run` — run a method on a set of queries.
- `data-to-tsv` — standardize dataset formats.
- `prompts-list` / `prompts-show` — explore prompt definitions.
- `script-gen` — generate bash scripts for Pyserini retrieval and trec_eval.

---

### 🔹 Prompt Bank (`prompt_bank.yaml`)
Central repository of all prompts, organized by method and version.

Each prompt entry includes:
```yaml
- id: genqr.keywords.v1
  method_family: genqr
  version: 1
  introduced_by: "Baseline keywords prompt"
  license: "CC-BY-4.0"
  authors: ["QueryReform Team"]
  template:
    system: "..."
    user: "..."
  notes: "..."