# ğŸ§  QueryReform â€” Project Structure & Overview

A unified, reproducible **Python toolkit** for *LLM-based query reformulation methods*.

This document describes the **folder hierarchy**, **purpose of each module**, and **how all components fit together**.

---

## ğŸŒ² Full Directory Tree

```text
queryreform/
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ CONTRIBUTING.md
â”œâ”€â”€ PROJECT_STRUCTURE.md
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ PROMPTS.md
â”‚   â”œâ”€â”€ DATASETS.md
â”‚   â””â”€â”€ CLI.md
â”‚
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ quickstart.ipynb
â”‚   â””â”€â”€ tiny_queries.tsv
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ templated_retrieval.sh
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_dataloader.py
â”‚   â”œâ”€â”€ test_prompts.py
â”‚   â”œâ”€â”€ test_methods_genqr.py
â”‚   â””â”€â”€ test_cli_script_gen.py
â”‚
â””â”€â”€ queryreform/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ cli.py
    â”œâ”€â”€ prompt_bank.yaml
    â”œâ”€â”€ pyserini_bridge.py
    â”‚
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ defaults.yaml
    â”‚
    â”œâ”€â”€ core/
    â”‚   â”œâ”€â”€ base.py
    â”‚   â”œâ”€â”€ llm.py
    â”‚   â”œâ”€â”€ prompts.py
    â”‚   â”œâ”€â”€ registry.py
    â”‚   â”œâ”€â”€ runner.py
    â”‚   â””â”€â”€ utils.py
    â”‚
    â”œâ”€â”€ data/
    â”‚   â””â”€â”€ dataloader.py
    â”‚
    â””â”€â”€ methods/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ genqr.py
        â”œâ”€â”€ genqr_ensemble.py
        â”œâ”€â”€ query2doc.py
        â”œâ”€â”€ qa_expand.py
        â”œâ”€â”€ mugi.py
        â”œâ”€â”€ lamer.py
        â””â”€â”€ query2e.py

---

## ğŸ  Root Directory

| File | Purpose |
|------|----------|
| **pyproject.toml** | Defines package metadata, dependencies, and entry points (CLI via Typer). |
| **README.md** | Project overview, installation, and usage examples. |
| **LICENSE** | MIT License. |
| **.gitignore** | Standard Python ignores (cache, build, etc.). |
| **.env.example** | Environment variable template (e.g., `OPENAI_API_KEY`, `OPENAI_BASE_URL`). |
| **CONTRIBUTING.md** | Guidelines for contributing new methods or prompts. |
| **PROJECT_STRUCTURE.md** | This document. |

---

## ğŸ“š Documentation (`docs/`)

Markdown documentation for key features.

| File | Description |
|------|--------------|
| **PROMPTS.md** | Explains how to structure and contribute to the central prompt bank. |
| **DATASETS.md** | Describes how to load MS MARCO, BEIR, or local datasets. |
| **CLI.md** | Reference for CLI commands and arguments. |

---

## ğŸ§© Examples (`examples/`)

| File | Description |
|------|--------------|
| **quickstart.ipynb** | Minimal notebook demonstrating data loading and query reformulation. |
| **tiny_queries.tsv** | Tiny sample dataset for dry-run testing. |

---

## âš™ï¸ Scripts (`scripts/`)

| File | Description |
|------|--------------|
| **templated_retrieval.sh** | Example shell script generated by the CLI command `queryreform script-gen`. |

---

## âœ… Tests (`tests/`)

Automated unit tests for core modules and method logic (run via `pytest`).

| File | Description |
|------|--------------|
| **test_dataloader.py** | Validates `UnifiedQuerySource` for local TSV input. |
| **test_prompts.py** | Verifies prompt bank integrity. |
| **test_methods_genqr.py** | Tests `GenQREnsemble` reformulation workflow. |
| **test_cli_script_gen.py** | Ensures CLI generates valid retrieval bash scripts. |

---

## ğŸ§  Main Package (`queryreform/`)

This directory contains all toolkit code.

### ğŸ”¹ CLI Interface (`cli.py`)
Implements the **Typer-based** command-line interface with commands:
- `run` â€” run a method on a set of queries.
- `data-to-tsv` â€” standardize dataset formats.
- `prompts-list` / `prompts-show` â€” explore prompt definitions.
- `script-gen` â€” generate bash scripts for Pyserini retrieval and trec_eval.

---

### ğŸ”¹ Prompt Bank (`prompt_bank.yaml`)
Central repository of all prompts, organized by method and version.

Each prompt entry includes:
```yaml
- id: genqr.keywords.v1
  method_family: genqr
  version: 1
  introduced_by: "Baseline keywords prompt"
  license: "CC-BY-4.0"
  authors: ["QueryReform Team"]
  template:
    system: "..."
    user: "..."
  notes: "..."